<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="icon" type="image/png" href="docs/favicon.png">
    <link rel='apple-touch-icon' href='docs/ad256.png'>
    <link rel='image_src' href='docs/ad256.png'> 
    <meta property='og:type' content='website'>
    <meta property='og:title' content='Wanted! Minigame'>
    <meta property='og:url' content='https://nectarboy.github.io/MarioWanted'>
    <meta property='og:image' itemprop="image primaryImageOfPage" content='https://github.com/nectarboy/MarioWanted/blob/main/docs/ad256.png?raw=true'>
    <meta property='og:description' content='Play the "Wanted" Mario minigame online!'>
    <meta name='description' content='Play the "Wanted" Mario minigame online!'>
    <meta name='keywords' content='mario, wanted, mariowanted, wanted minigame, minigame, mini game, new super mario bros, super mario 64 ds, find luigi, findluigi'>
    <meta name='author' content='github.com/nectarboy'>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wanted!</title>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
        }
        .game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        canvas {
            display: block;
        }
        .Canvas {
            image-rendering: smoothing;
        }
        h3, pre {
            position: absolute;
            bottom: 10px;
            text-align: center;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas class='Canvas' id='canvas'></canvas>
    </div>
    <h3>wanted minigame 1 week challenge</h3>
    <pre>nectarboy | 2024</pre>

    <script src='Tone.js'></script>
    <script src='assets.js'></script>
    <script src='controller.js'></script>
    <script src='helpers.js'></script>
    <script src='loop.js'></script>
    <script src='level_generation.js'></script>
    <script>
        var W = 256;
        var SH = 192;
        var H = SH*2;

        var canvas = document.getElementById('canvas');
        var scale = Math.ceil(Math.min(window.outerWidth / W, window.outerHeight / H));
        if (scale > 32) scale = 32;
        canvas.width = W*scale;
        canvas.height = H*scale;
        window.onresize = function() {
            if (window.innerWidth / window.innerHeight < W / H) {
                canvas.style.width = '95vw';
                canvas.style.height = 'initial';
            }
            else {
                canvas.style.height = '95vh';
                canvas.style.width = 'initial';
            }
        };
        window.onresize();

        var ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // Initialize game loop, controller, and assets loading...
        var loop = new Loop();
        loop.doframeskip = true;
        var controller = new Controller(canvas);

        var assets = {};
        var bundle = [
            ['mario', 'image', 'src/gfx/mario.png'],
            ['luigi', 'image', 'src/gfx/luigi.png'],
            ['wario', 'image', 'src/gfx/wario.png'],
            ['yoshi', 'image', 'src/gfx/yoshi.png'],

            ['wanted_bg', 'image', 'src/gfx/wanted_bg.png'],
            ['mario_big', 'image', 'src/gfx/mario_big.png'],
            ['luigi_big', 'image', 'src/gfx/luigi_big.png'],
            ['wario_big', 'image', 'src/gfx/wario_big.png'],
            ['yoshi_big', 'image', 'src/gfx/yoshi_big.png'],

            ['time', 'image', 'src/gfx/time.png'],
            ['level', 'image', 'src/gfx/level.png'],
            ['numbers', 'image', 'src/gfx/numbers.png'],
            ['plus_five', 'image', 'src/gfx/plus_five.png'],
            ['minus_ten', 'image', 'src/gfx/minus_ten.png'],

            ['bgm', 'audio', 'src/sfx/bgm_loop.wav'],
            ['timer_tick', 'audio', 'src/sfx/timer_tick.wav'],
            ['timer_tick_urgent', 'audio', 'src/sfx/timer_tick_urgent.wav'],
            ['drumroll', 'audio', 'src/sfx/drumroll_loop.wav'],
            ['drumroll_end', 'audio', 'src/sfx/drumroll_end.wav'],
            ['correct', 'audio', 'src/sfx/correct_fixed.wav'],
            ['incorrect', 'audio', 'src/sfx/incorrect.wav'],
            ['timer_add', 'audio', 'src/sfx/timer_add.wav'],
            ['star_get', 'audio', 'src/sfx/star_get.wav'],
        ];

        Assets.loadAssetBundle(assets, bundle,
        (i) => {
            Helpers.drawBg(ctx);
            Helpers.drawLoadingBar(ctx, i/bundle.length);
        },
        () => {
            console.log('done loading');
            Helpers.drawBg(ctx);
            Helpers.drawText(ctx, ['Click to Start!']);
            controller.enableMouse();

            function onInput() {
                start();
                canvas.removeEventListener('touchend', onInput);
                canvas.removeEventListener('click', onInput);
            }

            canvas.addEventListener('touchend', onInput);
            canvas.addEventListener('click', onInput);
        },
        (e) => {
            throw e;
        });

    </script>
</body>
</html>
